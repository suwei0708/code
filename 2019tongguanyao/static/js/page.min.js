function initPageEvents(){document.body.addEventListener("touchmove",bodyScroll,{passive:!1}),$("body").one("touchstart",function(){app.music&&app.music.play()}),$(".p1-btn").on("click",function(){$(".page").hide(),$(".page2").fadeIn(),document.body.removeEventListener("touchmove",bodyScroll,{passive:!1}),pos=[$(".p2").offset().top,$(".p3").offset().top,$(".p4").offset().top,$(".p5").offset().top,$(".p6").offset().top,$(".p7").offset().top],total=parseInt($(".p8").offset().top+$(".p8").height())-200}),$(".p1, .p9").css({height:$(window).height()}),$(".btn-tijiao").on("click",function(){if(!isClick)return!1;if(!$.trim($("#form input[name=name]").val()))return alertTips("姓名不能为空！"),!1;if(!$.trim($("#form input[name=sex]:checked").val()))return alertTips("请选择性别！"),!1;isClick=0;var t=$.trim($("#form input[name=name]").val()),e=$.trim($("#form input[name=sex]:checked").val()),a={p2:["#6ad0e6","#febb74","#86a3dd","#b36ec1"],p3:[t+"对一切冰凉的食物都充满占有欲",t+"对世界的认知只有“命是空调给的”",t+"对碳水饮料报以热枕","天气一热，"+t+"的耐心会渐渐消失"],p4:["发呆会让"+t+"感到心情愉悦",t+"是个天真无邪的物种，对人类没有防备心",t+"有点呆萌，但是偶尔为之",t+"的笑容会把空气变甜，小心被齁到"],p5:["不要让"+t+"做选择，再难，"+e+"也会挺过去",t+"为易胖体质，不自觉会频繁喂食",t+"是一种拥有强大自愈能力的稀有品种",t+"脑子里可能有矿，每天都能开放出不同宝藏"],p6:[t+"依靠吃来恢复精力，要给"+e+"足够的空间哦",t+"除了睡觉时间不睡觉，其余时间都想睡觉",t+"有时会背对人类，静静思考",t+"宅在家里会长蘑菇，记得常常带"+e+"出去溜达"],p7:[t+"是一个看起来高冷，被关怀后温暖呆萌的物种",t+"这种神奇生物总能找到一件事，令"+e+"喜悦的部分，并将之放大",t+"喜欢安静，请给"+e+"安置一个清净小窝","宅在家里会长蘑菇，记得常常带"+e+"出去溜达",t+"本物种天下仅此一只，要正确温柔的对待"+e+"哦",t+"心情不好的时候，就给"+e+"讲个冷笑话吧",t+"可爱极易令人上瘾，可能引发“一天不吸，浑身难受”症状",t+"的孩子气让"+e+"拥有与年龄不符的长相，请不要感到惊讶"]};return $(".spinner-box").show(),$("#ringoImage").attr("src","./static/img/result"+arr[0]+".jpg "),$("#ringoImage").on("load",function(){var e=document.getElementById("ringoImage"),i=document.getElementById("ecode"),n=convertImageToCanvas(e,i,t,a);document.getElementById("canvasHolder").appendChild(n),document.getElementById("pngHolder").appendChild(convertCanvasToImage(n)),$(".spinner-box, .page").hide(),$(".page4").fadeIn(),document.body.addEventListener("touchmove",bodyScroll,{passive:!1}),isClick=1}),!1}),arr.length=$(".page2").find(".p").length-1,$(".box").on("click","img",function(){var t=$(this);if(t.parents(".p").hasClass("p8")){if(t.hasClass("cur"))return $.each($(".select").find("div"),function(){$(this).attr("data-select")==t.attr("data-option")&&$(this).attr("data-select","").html("")}),t.parents(".box").find("[data-option="+t.attr("data-option")+"]").removeClass("cur"),!1;t.parents(".box").find(".cur").length<6&&($.each($(".select").find("div"),function(){if(!$(this).html())return $(this).attr("data-select",t.attr("data-option")).html('<img src="./static/img/p8-'+t.attr("data-option")+'.png"><img class="text" src="./static/img/p8-t'+t.attr("data-option")+'.png"><div class="close" data-option="'+t.attr("data-option")+'">X</div>'),!1}),t.parents(".box").find("[data-option="+t.attr("data-option")+"]").addClass("cur"))}else{var e=t.parents(".p").index();$(this).addClass("cur").siblings().removeClass("cur"),arr[e]=t.attr("data-option")}}),$(".select").on("click",".close",function(){var t=$(this);$.each($(".p8").find(".cur"),function(){$(this).attr("data-option")==t.attr("data-option")&&$(this).removeClass("cur")}),$(this).parent("div").html("")}).on("click",".btn",function(){var t=0;$.each($(".select > div"),function(e){$(this).html()&&t++});var e=0;3==t?($.each(arr,function(t){if(void 0===arr[t])return $(".scroll").animate({scrollTop:pos[t]},200),alertTips("这道题还没答哦~"),!1;e++}),e==arr.length&&($(".page").hide(),$(".page3").fadeIn(),document.body.addEventListener("touchmove",bodyScroll,{passive:!1}))):alertTips("请选择3种消夏食物")}),$("#form").on("focus",".input",function(){document.body.removeEventListener("touchmove",bodyScroll,{passive:!1})}),document.body.addEventListener("focusout",function(){setTimeout(function(){var t=document.documentElement.scrollTop||document.body.scrollTop||0;window.scrollTo(0,Math.max(t-1,0)),document.body.addEventListener("touchmove",bodyScroll,{passive:!1})},100)}),$(".scroll").on("scroll",function(){$(this).scrollTop()+$(window).height()>=total?$(".arrow").hide():$(".arrow").show()})}function convertImageToCanvas(t,e,a,i){var n=document.createElement("canvas");n.width=t.width,n.height=t.height;var o=n.getContext("2d");o.save(),o.drawImage(t,0,0,750,1212),o.drawImage(e,545,1033,88,88);var r=$(".select").children("div:eq(0)").find("img:eq(0)")[0],s=$(".select").children("div:eq(1)").find("img:eq(0)")[0],c=$(".select").children("div:eq(2)").find("img:eq(0)")[0],d=$(".select").children("div:eq(0)").find("img:eq(1)")[0],l=$(".select").children("div:eq(1)").find("img:eq(1)")[0],p=$(".select").children("div:eq(2)").find("img:eq(1)")[0],h=170,m=165,u=(h-r.width)/2,f=(m-r.height)/2,g=(h-s.width)/2,v=(m-s.height)/2,b=(h-c.width)/2,w=(m-c.height)/2;return o.drawImage(r,122+u,414+f,r.width,r.height),o.drawImage(s,297+g,414+v,s.width,s.height),o.drawImage(c,471+b,414+w,c.width,c.height),o.drawImage(d,122,414,d.width,d.height),o.drawImage(l,297,414,l.width,l.height),o.drawImage(p,471,414,p.width,p.height),o.fillStyle="#333",o.font="34px Microsoft Yahei",o.textAlign="center",o.fillText(a,608,198),o.font="38px Microsoft Yahei",o.fillText(a,195,315),o.font="20px Microsoft Yahei",o.textAlign="left",o.fillText(i.p3[arr[1]],169,698),o.fillText(i.p4[arr[2]],169,730),o.fillText(i.p5[arr[3]],169,764),o.fillText(i.p6[arr[4]],169,898),writeTextOnCanvas(o,32,46,i.p7[arr[5]],169,930),o.restore(),o.stroke(),n}function writeTextOnCanvas(t,e,a,i,n,o){function r(t){for(var e=t.length,a=0,i=0;i<e;i++)t.charCodeAt(i)>128?a+=2:a+=1;return a}function s(t,e){for(var a=t.length,i=a,n=0,o=0;o<a;o++)if(t.charCodeAt(o)>128){if(!(n+2<e)){i=o;break}n+=2}else{if(!(n+1<e)){i=o;break}n+=1}return i}for(var c=1;r(i)>0;c++){var d=s(i,a);t.fillText(i.substr(0,d).replace(/^\s+|\s+$/,""),n,(c-1)*e+o),i=i.substr(d)}}function convertCanvasToImage(t){var e=new Image;return e.crossOrigin="anonymous",e.src=t.toDataURL("image/png"),e}function bodyScroll(t){t.preventDefault()}function alertTips(t,e){$(".alerttips-box").length||($("#content").append('<div class="alerttips-box"><div class="alerttips"></div></div>'),$("body").append()),$(".alerttips").html(t),$(".alerttips-box").show(),time=e||2e3,clearTimeout(alertTimes),alertTimes=setTimeout(function(){$(".alerttips-box").hide()},time)}function hanldeAnimate(t){$(".page").find("[data-anim]").each(function(){$(this).removeClass($(this).data("anim"))}),$(".page").eq(t).find("[data-anim]").each(function(){$(this).addClass($(this).data("anim"))})}var app={},isClick=1;app.width,app.height,app.loop=!1,app.DEFAULT_WIDTH=750,app.DEFAULT_HEIGHT=1334,app.baseUrl="static/img/",app.music=$("#bg")[0],app.init=function(){app.music&&app.music.play(),document.addEventListener("WeixinJSBridgeReady",function(){app.music.play()},!1);var t=["./static/img/result1.jpg","./static/img/result2.jpg","./static/img/result3.jpg"];$.each($("#content img"),function(){t.push($(this).attr("src"))}),$.imgpreload(t,{each:function(e){var a=$(this).data("loaded")?"success":"error";if("success"==a){var i=(e.length/t.length).toFixed(2);$(".percentage span").width(Math.round(100*i)+"%"),$("#percentage").html("loading "+Math.round(100*i)+"%")}},all:function(){setTimeout(function(){$(".loading").fadeOut(),$(".page1").fadeIn(),hanldeAnimate(0)},500)}})},$(function(){app.init(),initPageEvents()});var alertTimes,arr=[],pos=[],total=0;